---

- hosts: ubuntu_servers
  become: yes

  tasks:
    - name: Update package cache
      command: sudo apt-get update
      changed_when: false

    - name: Install fail2ban
      command: sudo apt-get install -y fail2ban

    - name : Copy configuration
      become: yes
      become_method: sudo
      copy:
        src: configfiles/debian-sshd-default.conf
        dest: /etc/fail2ban/jail.d/debian-sshd-default.conf.1

    - name: restart fail2ban
      become: yes
      become_method: sudo
      command: 
        cmd: sudo systemctl restart fail2ban
